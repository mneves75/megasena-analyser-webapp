# ============================================================================
# Staging Docker Compose Configuration
# Usage: docker compose -f docker-compose.yml -f docker-compose.staging.yml up -d
# Domain: staging.megasena-analyzer.com.br (via Caddy reverse proxy)
# ============================================================================

services:
  app:
    container_name: megasena-analyzer-staging

    build:
      context: .
      dockerfile: Dockerfile

    # Staging ports (different from production to allow parallel running)
    # Production: 3000, 3301
    # Staging: 3100, 3401
    ports:
      - "3100:3000"
      - "3401:3201"

    environment:
      - NODE_ENV=production
      - PORT=3000
      - API_PORT=3201
      - API_HOST=localhost
      - DATABASE_PATH=/app/db/mega-sena.db
      - NEXT_PUBLIC_BASE_URL=https://staging.megasena-analyzer.com.br
      - NEXT_TELEMETRY_DISABLED=1
      - ALLOWED_ORIGINS=https://staging.megasena-analyzer.com.br

    # Lower resource limits for staging
    deploy:
      replicas: 1
      resources:
        limits:
          cpus: '0.5'
          memory: 384M
        reservations:
          cpus: '0.25'
          memory: 192M
      restart_policy:
        condition: on-failure
        delay: 5s
        max_attempts: 3

    logging:
      driver: "json-file"
      options:
        max-size: "5m"
        max-file: "2"
